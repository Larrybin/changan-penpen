# 国际化（i18n）集成说明

本项目已使用 `next-intl` 完成多语言支持，目标语言：`en`（默认，不加前缀）、`de`、`fr`、`pt`。

## 关键位置

- 配置与消息：`src/i18n`
  - 语言配置：`src/i18n/config.ts`
  - 请求配置：`src/i18n/request.ts`
  - 消息文件：`src/i18n/messages/{en,de,fr,pt}.json`
- 中间件（语言路由 + 访问控制）：`middleware.ts`
- 根布局（Provider 注入）：`src/app/layout.tsx`
- 语言切换组件：`src/components/LanguageSwitcher.tsx`
- 示例使用：`src/modules/marketing/components/public-header.tsx`（已挂载切换器）

## 路由策略

- 默认语言 `en` 无路径前缀；其他语言按需添加前缀（`localePrefix = "as-needed"`）。
- `middleware.ts` 通过 `next-intl/middleware` 进行语言解析与重写，同时仅对 `/dashboard` 进行会话校验与保护（无论是否带语言前缀）。

## 在组件中取文案

```tsx
import {useTranslations} from "next-intl";

export default function Example() {
    const t = useTranslations("Common");
    return <h1>{t("welcome")}</h1>;
}
```

将对应键值添加到各语言 JSON，例如 `src/i18n/messages/en.json`：

```json
{
  "Common": {"welcome": "Welcome"}
}
```

## 语言切换

已提供 `LanguageSwitcher`（基于 `next-intl/client` 的路由），会自动处理默认语言不加前缀的导航：

```tsx
import LanguageSwitcher from "@/components/LanguageSwitcher";

// 直接在任意 Client 组件中使用
<LanguageSwitcher />
```

## 新增语言

1. 在 `src/i18n/config.ts` 的 `locales` 数组中新增代码；必要时更新默认语言。
2. 新增对应 `src/i18n/messages/<lang>.json`。
3. 文案引用处无需改动；切换器会自动出现该语言选项。

## 注意事项

- 如需本地化页面 `metadata`，可在页面的 `generateMetadata` 中使用 `next-intl/server` 的 `getMessages` + `createTranslator` 来生成多语言标题/描述。
- 若后续需要将所有页面目录改为显式 `[locale]` 分段，也可无缝迁移；当前方案无需移动目录结构。

