{
  "openapi": "3.1.0",
  "info": {
    "title": "Changan-penpen API",
    "version": "1.1.0",
    "description": "自动生成的 OpenAPI 文档，结合 Zod schema 同步维护 API 与 Server Action。"
  },
  "servers": [
    {
      "url": "http://localhost:3000/api/v1",
      "description": "默认 API 基础地址，可在 NEXT_PUBLIC_APP_URL 中覆盖"
    }
  ],
  "security": [
    {
      "BetterAuthSession": []
    }
  ],
  "tags": [
    {
      "name": "AI",
      "description": "AI 摘要能力"
    },
    {
      "name": "Usage",
      "description": "用量记录与统计"
    },
    {
      "name": "Credits",
      "description": "积分余额与流水"
    },
    {
      "name": "Admin",
      "description": "管理后台接口"
    },
    {
      "name": "Internal Actions",
      "description": "仅供内部 Server Action 使用的文档化说明"
    }
  ],
  "components": {
    "securitySchemes": {
      "BetterAuthSession": {
        "type": "apiKey",
        "in": "cookie",
        "name": "better-auth.session_token",
        "description": "Better Auth 登录态 Cookie。前后端请求均需携带以访问受保护接口。"
      }
    },
    "schemas": {
      "SummaryResult": {
        "type": "object",
        "properties": {
          "summary": {
            "type": "string",
            "example": "The announcement introduces new tooling..."
          },
          "originalLength": {
            "type": "integer",
            "description": "原文字符数",
            "example": 1024
          },
          "summaryLength": {
            "type": "integer",
            "description": "摘要字符数",
            "example": 256
          },
          "tokensUsed": {
            "type": "object",
            "properties": {
              "input": {
                "type": "integer",
                "description": "输入估算 token",
                "example": 350
              },
              "output": {
                "type": "integer",
                "description": "输出估算 token",
                "example": 90
              }
            },
            "required": [
              "input",
              "output"
            ],
            "description": "估算 token 消耗"
          }
        },
        "required": [
          "summary",
          "originalLength",
          "summaryLength",
          "tokensUsed"
        ],
        "description": "AI 摘要接口成功返回的数据结构"
      },
      "SummarizeSuccessResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "enum": [
              true
            ],
            "example": true
          },
          "data": {
            "$ref": "#/components/schemas/SummaryResult"
          },
          "error": {
            "example": null
          }
        },
        "required": [
          "success",
          "data"
        ],
        "description": "AI 文本摘要接口返回的摘要结果。",
        "example": {
          "success": true,
          "data": {
            "summary": "The announcement introduces a toolset that simplifies AI application delivery...",
            "originalLength": 1024,
            "summaryLength": 256,
            "tokensUsed": {
              "input": 350,
              "output": 90
            }
          },
          "error": null
        }
      },
      "ApiErrorDetail": {
        "type": "object",
        "properties": {
          "code": {
            "type": "string",
            "minLength": 1,
            "example": "INVALID_REQUEST",
            "description": "错误编码"
          },
          "message": {
            "type": "string",
            "minLength": 1,
            "example": "参数校验失败",
            "description": "错误信息"
          },
          "details": {
            "description": "可选的附加调试信息"
          }
        },
        "required": [
          "code",
          "message"
        ]
      },
      "AuthRequiredResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "enum": [
              false
            ],
            "example": false
          },
          "error": {
            "$ref": "#/components/schemas/ApiErrorDetail"
          },
          "status": {
            "type": "integer",
            "example": 400
          },
          "timestamp": {
            "type": "string",
            "example": "2025-03-05T12:34:56.000Z",
            "description": "ISO 时间戳"
          },
          "traceId": {
            "type": "string",
            "example": "8f4c2e7a9b",
            "description": "用于日志关联的追踪 ID"
          }
        },
        "required": [
          "success",
          "error",
          "status",
          "timestamp",
          "traceId"
        ],
        "description": "当请求缺少有效登录会话时返回。",
        "example": {
          "success": false,
          "status": 401,
          "timestamp": "2025-03-05T12:34:56.000Z",
          "traceId": "auth-unauthorized",
          "error": {
            "code": "UNAUTHORIZED",
            "message": "Authentication required"
          }
        }
      },
      "ApiErrorResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "enum": [
              false
            ],
            "example": false
          },
          "error": {
            "$ref": "#/components/schemas/ApiErrorDetail"
          },
          "status": {
            "type": "integer",
            "example": 400
          },
          "timestamp": {
            "type": "string",
            "example": "2025-03-05T12:34:56.000Z",
            "description": "ISO 时间戳"
          },
          "traceId": {
            "type": "string",
            "example": "8f4c2e7a9b",
            "description": "用于日志关联的追踪 ID"
          }
        },
        "required": [
          "success",
          "error",
          "status",
          "timestamp",
          "traceId"
        ],
        "description": "标准化的错误响应结构。",
        "example": {
          "success": false,
          "status": 400,
          "timestamp": "2025-03-05T12:34:56.000Z",
          "traceId": "8f4c2e7a9b",
          "error": {
            "code": "INVALID_REQUEST",
            "message": "参数校验失败",
            "details": {
              "field": "email"
            }
          }
        }
      },
      "SummarizerConfig": {
        "type": "object",
        "properties": {
          "maxLength": {
            "type": "integer",
            "minimum": 50,
            "maximum": 1000,
            "default": 200,
            "description": "限制摘要的最大词数",
            "example": 200
          },
          "style": {
            "type": "string",
            "enum": [
              "concise",
              "detailed",
              "bullet-points"
            ],
            "default": "concise",
            "description": "摘要风格",
            "example": "concise"
          },
          "language": {
            "type": "string",
            "minLength": 1,
            "maxLength": 50,
            "default": "English",
            "description": "摘要输出语言",
            "example": "English"
          }
        },
        "description": "可选的摘要配置。如果缺省则使用默认值。"
      },
      "SummarizeRequest": {
        "type": "object",
        "properties": {
          "text": {
            "type": "string",
            "minLength": 50,
            "maxLength": 50000,
            "description": "待摘要的原文内容",
            "example": "OpenAI announced a new suite of tools designed to make AI development more accessible..."
          },
          "config": {
            "$ref": "#/components/schemas/SummarizerConfig"
          }
        },
        "required": [
          "text"
        ],
        "description": "AI 摘要接口的请求负载"
      },
      "UsageRecordResult": {
        "type": "object",
        "properties": {
          "date": {
            "type": "string",
            "example": "2025-03-05",
            "description": "记录所属日期"
          },
          "credits": {
            "type": [
              "number",
              "null"
            ],
            "description": "扣减后剩余积分，若不扣减则为 null",
            "example": 420
          }
        },
        "required": [
          "date",
          "credits"
        ],
        "description": "记录成功后返回的日期与剩余积分。"
      },
      "UsageRecordResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "enum": [
              true
            ],
            "example": true
          },
          "data": {
            "$ref": "#/components/schemas/UsageRecordResult"
          },
          "error": {
            "example": null
          }
        },
        "required": [
          "success",
          "data"
        ],
        "description": "记录用量成功时的响应体。",
        "example": {
          "success": true,
          "data": {
            "date": "2025-03-05",
            "credits": 420
          },
          "error": null
        }
      },
      "UsageRecordRequest": {
        "type": "object",
        "properties": {
          "feature": {
            "type": "string",
            "minLength": 1,
            "example": "ai.summarize",
            "description": "功能唯一标识"
          },
          "amount": {
            "type": "number",
            "exclusiveMinimum": 0,
            "example": 1,
            "description": "本次使用量"
          },
          "unit": {
            "type": "string",
            "minLength": 1,
            "example": "calls",
            "description": "计量单位"
          },
          "metadata": {
            "type": "object",
            "additionalProperties": {},
            "description": "业务侧自定义的扩展字段",
            "example": {
              "source": "dashboard",
              "model": "llama"
            }
          },
          "consumeCredits": {
            "type": "number",
            "exclusiveMinimum": 0,
            "description": "同时扣减的积分数量，可选",
            "example": 5
          }
        },
        "required": [
          "feature",
          "amount",
          "unit"
        ],
        "description": "记录用量时提交的请求体。"
      },
      "UsageStatsRow": {
        "type": "object",
        "properties": {
          "date": {
            "type": "string",
            "example": "2025-03-01",
            "description": "统计日期"
          },
          "feature": {
            "type": "string",
            "example": "ai.summarize",
            "description": "功能唯一标识"
          },
          "totalAmount": {
            "type": "number",
            "example": 25,
            "description": "当日累计使用量"
          },
          "unit": {
            "type": "string",
            "example": "calls"
          }
        },
        "required": [
          "date",
          "feature",
          "totalAmount",
          "unit"
        ],
        "description": "每日用量明细。"
      },
      "UsageStatsPayload": {
        "type": "object",
        "properties": {
          "fromDate": {
            "type": "string",
            "example": "2025-02-04",
            "description": "统计起始日期"
          },
          "toDate": {
            "type": "string",
            "example": "2025-03-05",
            "description": "统计结束日期"
          },
          "rows": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/UsageStatsRow"
            },
            "description": "每日聚合结果列表"
          }
        },
        "required": [
          "fromDate",
          "toDate",
          "rows"
        ],
        "description": "Usage Stats 接口返回的聚合数据。"
      },
      "UsageStatsResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "enum": [
              true
            ],
            "example": true
          },
          "data": {
            "$ref": "#/components/schemas/UsageStatsPayload"
          },
          "error": {
            "example": null
          }
        },
        "required": [
          "success",
          "data"
        ],
        "description": "用量统计查询的响应体。",
        "example": {
          "success": true,
          "data": {
            "fromDate": "2025-02-04",
            "toDate": "2025-03-05",
            "rows": [
              {
                "date": "2025-03-05",
                "feature": "ai.summarize",
                "totalAmount": 3,
                "unit": "calls"
              }
            ]
          },
          "error": null
        }
      },
      "CreditBalancePayload": {
        "type": "object",
        "properties": {
          "credits": {
            "type": "integer",
            "minimum": 0,
            "example": 480,
            "description": "当前积分余额"
          }
        },
        "required": [
          "credits"
        ],
        "description": "余额查询返回的积分数据。"
      },
      "CreditBalanceResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "enum": [
              true
            ],
            "example": true
          },
          "data": {
            "$ref": "#/components/schemas/CreditBalancePayload"
          },
          "error": {
            "example": null
          }
        },
        "required": [
          "success",
          "data"
        ],
        "description": "积分余额查询成功时返回。",
        "example": {
          "success": true,
          "data": {
            "credits": 480
          },
          "error": null
        }
      },
      "CreditTransaction": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "example": 123
          },
          "amount": {
            "type": "number",
            "example": 50
          },
          "remainingAmount": {
            "type": "number",
            "example": 20,
            "description": "尚未消耗的数量"
          },
          "type": {
            "type": "string",
            "example": "MONTHLY_REFRESH",
            "description": "交易类型"
          },
          "description": {
            "type": "string",
            "example": "月度额度刷新"
          },
          "expirationDate": {
            "type": [
              "string",
              "null"
            ],
            "description": "过期时间（如有）",
            "example": "2025-04-01T00:00:00.000Z"
          },
          "paymentIntentId": {
            "type": [
              "string",
              "null"
            ],
            "example": null
          },
          "createdAt": {
            "type": "string",
            "example": "2025-03-01T10:00:00.000Z"
          },
          "updatedAt": {
            "type": "string",
            "example": "2025-03-01T10:00:00.000Z"
          }
        },
        "required": [
          "id",
          "amount",
          "remainingAmount",
          "type",
          "description",
          "expirationDate",
          "paymentIntentId",
          "createdAt",
          "updatedAt"
        ],
        "description": "积分流水记录。"
      },
      "PaginationMeta": {
        "type": "object",
        "properties": {
          "total": {
            "type": "integer",
            "minimum": 0,
            "example": 120,
            "description": "总记录数"
          },
          "pages": {
            "type": "integer",
            "minimum": 0,
            "example": 12,
            "description": "总页数"
          },
          "current": {
            "type": "integer",
            "minimum": 1,
            "example": 1,
            "description": "当前页码（从 1 开始）"
          }
        },
        "required": [
          "total",
          "pages",
          "current"
        ],
        "description": "通用分页元信息。"
      },
      "CreditHistoryPayload": {
        "type": "object",
        "properties": {
          "transactions": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CreditTransaction"
            },
            "description": "流水列表"
          },
          "pagination": {
            "$ref": "#/components/schemas/PaginationMeta"
          }
        },
        "required": [
          "transactions",
          "pagination"
        ],
        "description": "积分流水查询结果。"
      },
      "CreditHistoryResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "enum": [
              true
            ],
            "example": true
          },
          "data": {
            "$ref": "#/components/schemas/CreditHistoryPayload"
          },
          "error": {
            "example": null
          }
        },
        "required": [
          "success",
          "data"
        ],
        "description": "积分流水分页查询成功时返回。"
      },
      "AdminUser": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "example": "user_123"
          },
          "name": {
            "type": "string",
            "example": "Admin User"
          },
          "email": {
            "type": "string",
            "format": "email",
            "example": "admin@example.com"
          }
        },
        "required": [
          "id",
          "name",
          "email"
        ]
      },
      "AdminSessionResponse": {
        "type": "object",
        "properties": {
          "user": {
            "$ref": "#/components/schemas/AdminUser"
          }
        },
        "required": [
          "user"
        ],
        "description": "Admin session 接口返回的当前管理员信息。"
      },
      "AdminUnauthorizedResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "enum": [
              false
            ],
            "example": false
          },
          "error": {
            "$ref": "#/components/schemas/ApiErrorDetail"
          },
          "status": {
            "type": "integer",
            "example": 400
          },
          "timestamp": {
            "type": "string",
            "example": "2025-03-05T12:34:56.000Z",
            "description": "ISO 时间戳"
          },
          "traceId": {
            "type": "string",
            "example": "8f4c2e7a9b",
            "description": "用于日志关联的追踪 ID"
          }
        },
        "required": [
          "success",
          "error",
          "status",
          "timestamp",
          "traceId"
        ],
        "description": "Admin 接口鉴权失败时的统一响应结构。",
        "example": {
          "success": false,
          "status": 401,
          "timestamp": "2025-03-05T12:34:56.000Z",
          "traceId": "admin-unauthorized",
          "error": {
            "code": "UNAUTHORIZED",
            "message": "Administrator privileges required"
          }
        }
      },
      "AdminUsageRow": {
        "type": "object",
        "properties": {
          "userId": {
            "type": "string",
            "example": "tenant_1"
          },
          "date": {
            "type": "string",
            "example": "2025-03-05"
          },
          "feature": {
            "type": "string",
            "example": "ai.summarize"
          },
          "totalAmount": {
            "type": "number",
            "example": 12
          },
          "unit": {
            "type": "string",
            "example": "calls"
          },
          "email": {
            "type": [
              "string",
              "null"
            ],
            "example": "user@example.com"
          }
        },
        "required": [
          "userId",
          "date",
          "feature",
          "totalAmount",
          "unit",
          "email"
        ],
        "description": "管理员视角的用量记录。"
      },
      "AdminUsageResponse": {
        "type": "object",
        "properties": {
          "data": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/AdminUsageRow"
            }
          },
          "total": {
            "type": "integer",
            "example": 120
          }
        },
        "required": [
          "data",
          "total"
        ],
        "description": "Admin 用量列表 API 返回的聚合结果。"
      },
      "AdminCreditHistoryRow": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "example": 456
          },
          "amount": {
            "type": "number",
            "example": 100
          },
          "type": {
            "type": "string",
            "example": "MANUAL_ADJUST"
          },
          "description": {
            "type": "string",
            "example": "手动调整：补发额度"
          },
          "createdAt": {
            "type": "string",
            "example": "2025-03-05T09:30:00.000Z"
          },
          "customerEmail": {
            "type": [
              "string",
              "null"
            ],
            "format": "email",
            "example": "customer@example.com"
          },
          "userId": {
            "type": "string",
            "example": "tenant_1"
          }
        },
        "required": [
          "id",
          "amount",
          "type",
          "description",
          "createdAt",
          "customerEmail",
          "userId"
        ],
        "description": "积分流水记录（管理后台）。"
      },
      "AdminCreditHistoryResponse": {
        "type": "object",
        "properties": {
          "data": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/AdminCreditHistoryRow"
            }
          },
          "total": {
            "type": "integer",
            "example": 200
          }
        },
        "required": [
          "data",
          "total"
        ],
        "description": "管理员积分流水查询结果。"
      },
      "CreateTodoClientInput": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "minimum": -9007199254740991,
            "maximum": 9007199254740991
          },
          "title": {
            "type": "string",
            "minLength": 3,
            "maxLength": 255,
            "description": "任务标题",
            "example": "完成 Swagger 接入"
          },
          "description": {
            "type": "string",
            "maxLength": 1000,
            "description": "任务描述",
            "example": "补充自动化 API 文档"
          },
          "categoryId": {
            "type": "number",
            "description": "分类 ID，可选"
          },
          "status": {
            "type": "string",
            "enum": [
              "pending",
              "in_progress",
              "completed",
              "archived"
            ],
            "description": "任务状态",
            "example": "pending"
          },
          "priority": {
            "type": "string",
            "enum": [
              "low",
              "medium",
              "high",
              "urgent"
            ],
            "description": "优先级",
            "example": "medium"
          },
          "imageUrl": {
            "anyOf": [
              {
                "type": "string",
                "format": "uri"
              },
              {
                "type": "string",
                "enum": [
                  ""
                ]
              }
            ],
            "description": "关联图片地址，可选",
            "example": "https://cdn.example.com/todo.png"
          },
          "imageAlt": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "string",
                "enum": [
                  ""
                ]
              }
            ],
            "description": "图片替代文本"
          },
          "completed": {
            "type": "boolean",
            "description": "是否已完成",
            "example": false
          },
          "dueDate": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "string",
                "enum": [
                  ""
                ]
              }
            ],
            "description": "截止日期 (ISO 字符串)"
          },
          "createdAt": {
            "type": "string"
          },
          "updatedAt": {
            "type": "string"
          }
        },
        "required": [
          "title"
        ],
        "description": "Server Action 创建 Todo 时客户端提交的表单数据，不包含用户 ID。"
      }
    },
    "parameters": {}
  },
  "paths": {
    "/api/v1/summarize": {
      "post": {
        "tags": [
          "AI"
        ],
        "summary": "基于 Workers AI 对长文本进行摘要",
        "description": "接受原始文本与可选配置，调用 Workers AI 模型生成摘要并返回 tokens 使用情况。",
        "operationId": "postSummarize",
        "security": [
          {
            "BetterAuthSession": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SummarizeRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "摘要生成成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SummarizeSuccessResponse"
                }
              }
            }
          },
          "401": {
            "description": "未登录或会话失效",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthRequiredResponse"
                }
              }
            }
          },
          "500": {
            "description": "Workers AI 不可用或内部错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/usage/record": {
      "post": {
        "tags": [
          "Usage"
        ],
        "summary": "记录用户某项功能的用量",
        "description": "将指定功能的消耗写入用量表，可选同时扣减积分；用于后台统计与限额控制。",
        "operationId": "postUsageRecord",
        "security": [
          {
            "BetterAuthSession": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UsageRecordRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "记录成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UsageRecordResponse"
                }
              }
            }
          },
          "400": {
            "description": "请求参数校验失败",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "未登录",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthRequiredResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/usage/stats": {
      "get": {
        "tags": [
          "Usage"
        ],
        "summary": "按日聚合查询用量统计",
        "description": "按日期聚合返回指定窗口的用量信息，便于仪表盘展示与配额跟踪。",
        "operationId": "getUsageStats",
        "security": [
          {
            "BetterAuthSession": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "description": "查询最近 N 天，默认 30，最大 90",
              "example": "30"
            },
            "required": false,
            "description": "查询最近 N 天，默认 30，最大 90",
            "name": "days",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "统计查询成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UsageStatsResponse"
                }
              }
            }
          },
          "401": {
            "description": "未登录",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthRequiredResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/credits/balance": {
      "get": {
        "tags": [
          "Credits"
        ],
        "summary": "查询当前积分余额（自动刷新月度赠送）",
        "description": "返回当前用户的积分余额，包含月度赠送额度刷新后的最新结果。",
        "operationId": "getCreditsBalance",
        "security": [
          {
            "BetterAuthSession": []
          }
        ],
        "responses": {
          "200": {
            "description": "查询成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CreditBalanceResponse"
                }
              }
            }
          },
          "401": {
            "description": "未登录",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthRequiredResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/credits/history": {
      "get": {
        "tags": [
          "Credits"
        ],
        "summary": "分页查询积分流水记录",
        "description": "分页返回积分流水明细，可用于账单与对账场景。",
        "operationId": "getCreditsHistory",
        "security": [
          {
            "BetterAuthSession": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "example": "1",
              "description": "页码"
            },
            "required": false,
            "description": "页码",
            "name": "page",
            "in": "query"
          },
          {
            "schema": {
              "type": "string",
              "example": "10",
              "description": "每页条数"
            },
            "required": false,
            "description": "每页条数",
            "name": "limit",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "查询成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CreditHistoryResponse"
                }
              }
            }
          },
          "401": {
            "description": "未登录",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthRequiredResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/admin/session": {
      "get": {
        "tags": [
          "Admin"
        ],
        "summary": "校验当前登录用户是否具备管理员权限",
        "description": "返回当前管理员的基础信息，供前端在进入后台前做鉴权与展示。",
        "operationId": "getAdminSession",
        "security": [
          {
            "BetterAuthSession": []
          }
        ],
        "responses": {
          "200": {
            "description": "管理员会话有效",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdminSessionResponse"
                }
              }
            }
          },
          "401": {
            "description": "未登录或无管理员权限",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdminUnauthorizedResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/admin/usage": {
      "get": {
        "tags": [
          "Admin"
        ],
        "summary": "分页查询租户用量概览",
        "description": "查询所有租户的用量聚合数据，可按功能或租户过滤，用于后台报表。",
        "operationId": "getAdminUsage",
        "security": [
          {
            "BetterAuthSession": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "example": "1"
            },
            "required": false,
            "name": "page",
            "in": "query"
          },
          {
            "schema": {
              "type": "string",
              "example": "20"
            },
            "required": false,
            "name": "perPage",
            "in": "query"
          },
          {
            "schema": {
              "type": "string",
              "example": "tenant_1"
            },
            "required": false,
            "name": "tenantId",
            "in": "query"
          },
          {
            "schema": {
              "type": "string",
              "example": "ai.summarize"
            },
            "required": false,
            "name": "feature",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "查询成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdminUsageResponse"
                }
              }
            }
          },
          "401": {
            "description": "未登录或无管理员权限",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdminUnauthorizedResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/admin/credits-history": {
      "get": {
        "tags": [
          "Admin"
        ],
        "summary": "分页查询所有租户的积分流水",
        "description": "管理员视角分页查看积分流水，用于对账与异常排查。",
        "operationId": "getAdminCreditsHistory",
        "security": [
          {
            "BetterAuthSession": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "example": "1"
            },
            "required": false,
            "name": "page",
            "in": "query"
          },
          {
            "schema": {
              "type": "string",
              "example": "20"
            },
            "required": false,
            "name": "perPage",
            "in": "query"
          },
          {
            "schema": {
              "type": "string",
              "example": "tenant_1"
            },
            "required": false,
            "name": "tenantId",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "查询成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdminCreditHistoryResponse"
                }
              }
            }
          },
          "401": {
            "description": "未登录或无管理员权限",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdminUnauthorizedResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/internal/actions/todos/create": {
      "post": {
        "tags": [
          "Internal Actions"
        ],
        "summary": "Server Action：创建 Todo 任务",
        "description": "仅供前端表单通过 Server Action 调用，用于演示型 Todo 功能。",
        "operationId": "postInternalTodoCreate",
        "x-internal": true,
        "security": [
          {
            "BetterAuthSession": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "$ref": "#/components/schemas/CreateTodoClientInput"
              }
            }
          }
        },
        "responses": {
          "204": {
            "description": "创建成功，Server Action 会触发页面重定向。"
          },
          "400": {
            "description": "表单校验失败",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "未登录",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthRequiredResponse"
                }
              }
            }
          }
        }
      }
    }
  },
  "webhooks": {}
}
