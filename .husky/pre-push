#!/usr/bin/env sh
# Enforce using `pnpm push` for all pushes.

# If already launched by `pnpm push`, allow the inner push to proceed.
if [ "$PNPM_PUSH_RUNNING" = "1" ]; then
  echo "[pre-push] pnpm push context detected; allowing push."
  exit 0
fi

echo "[pre-push] Detected raw \`git push\`. Running \`pnpm push\` instead to execute local quality gates."

# Run push workflow (includes checks, commit, rebase & push). This nested push
# will re-enter this hook, but PNPM_PUSH_RUNNING=1 is set there to avoid loops.
pnpm push

# Cancel the outer push to avoid double-pushing.
exit 1
